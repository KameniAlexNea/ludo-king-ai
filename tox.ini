[tox]
envlist = format, test
skipsdist = True
skip_missing_interpreters = True
requires =
    tox-uv

[testenv:test]
description = Run tests with coverage
deps =
    -e .
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m pytest tests
    coverage report -m --include="src/*" --omit="*/test_*"
    coverage html --include="src/*" --omit="*/test_*"
    coverage xml --include="src/*" --omit="*/test_*"

[testenv:test-ci]
description = Run tests with coverage for CI (no HTML report)
deps =
    -e .
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m pytest tests
    coverage report -m --include="src/*" --omit="*/test_*" --fail-under=80
    coverage xml --include="src/*" --omit="*/test_*"

[testenv:format]
description = Format code with black and ruff
deps =
    black>=23.0,<25.0
    ruff>=0.1.0
    isort>=5.0
commands =
    isort tests/ src/
    black src/
    ruff check src/ --fix --ignore E712
    ruff format src/