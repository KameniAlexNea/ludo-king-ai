[tox]
envlist = format, test
skipsdist = True
skip_missing_interpreters = True

[testenv:test]
description = Run tests with coverage
deps =
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m unittest discover -s tests -p "test_*.py"
    coverage report -m --include="rl/*" --omit="*/test_*"
    coverage html --include="rl/*" --omit="*/test_*"
    coverage xml --include="rl/*" --omit="*/test_*"

[testenv:test-ci]
description = Run tests with coverage for CI (no HTML report)
deps =
    coverage>=7.0
    pytest>=7.0
    pytest-cov>=4.0
commands =
    coverage run -m unittest discover -s tests -p "test_*.py"
    coverage report -m --include="rl/*" --omit="*/test_*" --fail-under=80
    coverage xml --include="rl/*" --omit="*/test_*"

[testenv:format]
description = Format code with black and ruff
deps =
    black>=23.0,<25.0
    ruff>=0.1.0
    isort>=5.0
commands =
    isort rl/ tests/
    black rl/ tests/
    ruff check rl/ tests/ --fix --ignore E712
    ruff format rl/ tests/